# 🧶 像素织梦 (PixelKnit)

一个功能完整的 Web 编织引导应用程序，通过可视化网格地图帮助用户跟踪编织进度，支持多种编织模式和智能路径规划。

> **像素织梦** (PixelKnit) - 将像素图案编织成现实，让每一针都精准到位。

## ✨ 功能特性

### 核心功能

1. **双地图显示系统**
   - **地图列表**: 左侧显示所有可用地图的缩略图，实时展示整体编织进度
   - **网格编织图**: 中间主网格，支持交互操作和详细查看
   - **小地图统计**: 每个地图项显示颜色统计信息，前6种显示数量，其余显示色块

2. **编织状态管理**
   - **已完成方块**: 渐变蓝色透明覆盖层，清晰显示完成状态
   - **未完成方块**: 浅色透明状态，灰色边框
   - **路径高亮方块**: 完整颜色，深红色加粗边框
   - **悬停高亮**: 鼠标悬停时显示蓝色高亮边框
   - **完成标志**: 地图完成时在右上角显示绿色圆形完成标志

3. **路径选择模式**
   - **手动路径选择**: 点击选择起点，拖拽/点击设置终点，自动计算并高亮直线路径（Bresenham算法）
   - **对角预设模式**: 从右下角开始，按对角线从右向左推进的预设路径模式
   - **路径可视化**: 实时显示当前路径的颜色序列和统计信息

4. **对角预设模式功能**
   - 进入/退出对角预设模式（切换按钮）
   - **下一条**: 标记当前对角线为已完成，自动前进到下一条
   - **上一条**: 撤销上一条的完成状态，返回上一条
   - **标记为已完成**: 长按或点击标记当前路径，对角模式下自动前进
   - **长按支持**: 快速前进/后退，提升操作效率
   - **完成确认**: 编织完成且保存后，导航按钮自动禁用，需重置后才能继续

5. **进度跟踪系统**
   - **实时进度条**: 显示整体编织完成百分比，带闪烁动画效果
   - **路径状态显示**: 
     - 总方块数统计
     - 按颜色划分的方块数量（带色块显示）
     - 固定高度设计，避免布局偏移
   - **当前编织顺序横条**: 
     - 底部固定横条，显示当前路径的颜色序列
     - 每个色块显示数量徽章（红色渐变）
     - 支持点击高亮对应方块
     - 选中状态显示蓝色边框和放大效果
     - 单行显示，无滚动条

6. **放大镜功能**
   - 鼠标悬停时显示局部放大视图
   - 3倍放大，清晰的像素显示
   - 红色十字线指示中心位置
   - 固定位置显示，不受滚动影响
   - 智能定位，避免超出视口

7. **交互工具提示**
   - **方块工具提示**: 悬停时显示方块详细信息（坐标、颜色、RGB值、完成状态）
   - **颜色统计提示**: 小地图色块悬停显示RGB值和数量
   - 玻璃态效果，美观实用

8. **数据持久化**
   - 保存当前进度到 localStorage（按地图分别保存）
   - 加载上次保存的进度（自动恢复模式状态）
   - 重置所有进度（清除确认完成状态）
   - 完成确认机制：编织完成且保存后，导航按钮自动禁用

9. **性能优化**
   - **离屏Canvas缓存**: 静态网格缓存，大幅减少重绘次数
   - **事件节流**: 使用 requestAnimationFrame 节流鼠标移动事件
   - **DOM元素缓存**: 缓存地图项DOM引用，减少查询次数
   - **批量更新**: 批量操作 completedSquares 数组，提升性能
   - **智能重绘**: 仅重绘动态部分，静态部分使用缓存

10. **视觉设计**
    - **粒子背景系统**: 动态粒子背景，与博客主页保持一致
    - **玻璃态效果**: 半透明背景 + 模糊效果
    - **渐变色彩**: 蓝色到紫色的渐变主题
    - **现代化设计**: 圆角、阴影、平滑过渡动画
    - **响应式布局**: 适配桌面、平板和移动设备

## 🎨 设计风格

本应用采用与博客项目一致的艺术风格：

- **玻璃态效果**: 半透明背景 + 模糊效果（backdrop-filter）
- **渐变色彩**: 蓝色到紫色的渐变主题
- **现代化设计**: 圆角、阴影、平滑过渡动画
- **响应式布局**: 适配桌面、平板和移动设备
- **动态背景**: 粒子系统，交互式动画效果

## 🚀 使用方法

### 启动应用

1. 确保 `data/json/` 目录下有地图数据文件：
   - `maps_list.json`: 地图列表配置
   - `pixel_map_data.json`: 像素地图数据（或其他地图数据文件）

2. 在浏览器中打开 `index.html`

3. 或使用本地服务器（推荐）：
   ```bash
   # Python 3
   cd apps/knitting-guide
   python -m http.server 8000
   # 然后访问 http://localhost:8000
   ```

### 基本操作

1. **选择地图**:
   - 在左侧地图列表中点击选择要编织的地图
   - 地图项显示缩略图、名称和颜色统计信息

2. **手动路径选择**:
   - 在网格编织图上点击选择起点
   - 拖拽或点击设置终点
   - 系统自动计算并高亮直线路径
   - 点击"标记为已完成"按钮完成路径

3. **对角预设模式**:
   - 点击"进入对角预设模式"按钮
   - 系统自动计算所有对角线路径
   - 使用"下一条"/"上一条"按钮导航（支持长按快速操作）
   - 点击"标记为已完成"标记当前路径（长按或点击）
   - 对角模式下，标记完成后自动前进到下一条

4. **查看进度**:
   - 查看右侧浮动面板的进度条（实时百分比）
   - 查看当前路径状态信息（总方块数、颜色统计）
   - 查看底部编织顺序横条（颜色序列和数量）
   - 查看左侧小地图的完成状态（蓝色覆盖层、完成标志）

5. **保存/加载进度**:
   - 点击"保存当前进度"保存状态（自动检测完成状态）
   - 点击"加载上次进度"恢复状态（自动恢复模式）
   - 点击"重置当前进度"清除所有进度（恢复导航按钮）

6. **交互功能**:
   - 鼠标悬停查看放大镜（3倍放大）
   - 鼠标悬停查看方块详细信息（工具提示）
   - 点击颜色序列项高亮对应方块
   - 悬停小地图色块查看RGB值和数量

## 📁 项目结构

```
knitting-guide/
├── index.html          # 主页面（包含粒子背景系统）
├── style.css           # 样式表（玻璃态效果、响应式设计）
├── script.js           # 主应用逻辑（性能优化、完整功能）
├── data/               # 数据文件目录
│   └── json/           # JSON 数据文件
│       ├── maps_list.json      # 地图列表配置
│       └── pixel_map_data.json # 像素地图数据
└── README.md           # 项目说明文档
```

## 🔧 技术实现

### 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **Canvas API**: 用于网格渲染和交互（主网格、小地图、放大镜）
- **localStorage**: 客户端数据持久化（按地图分别保存）
- **Bresenham 算法**: 直线路径计算
- **粒子系统**: 动态背景效果
- **性能优化**: 离屏Canvas、事件节流、DOM缓存

### 核心算法

1. **Bresenham 直线算法**: 计算两点间的直线路径
2. **对角线路径计算**: 从右下角开始，按对角线从右向左推进
3. **完成状态检测**: 检查所有方块是否已完成（允许1-2个误差）
4. **路径优化**: 预计算所有对角线路径，提升性能

### 数据格式

JSON 数据格式：
```json
{
  "grid_data": [[1, 2, ...], ...],
  "color_map": {
    "1": [255, 0, 0],
    "2": [0, 255, 0],
    ...
  }
}
```

### 性能优化技术

1. **离屏Canvas缓存**: 静态网格缓存到离屏Canvas，减少重绘
2. **事件节流**: 使用 requestAnimationFrame 节流鼠标移动事件
3. **DOM元素缓存**: 使用 Map 缓存地图项DOM引用
4. **批量更新**: 批量操作数组，减少操作次数
5. **智能重绘**: 仅重绘动态部分，静态部分使用缓存

## 🌐 浏览器兼容性

- Chrome/Edge (推荐)
- Firefox
- Safari

## 📝 更新日志

### v1.0.0 (2025-11-09)
- ✅ 完整功能实现
- ✅ 性能优化（离屏Canvas、事件节流、DOM缓存）
- ✅ 完成确认机制
- ✅ 小地图颜色统计
- ✅ 交互工具提示
- ✅ 响应式设计

## 📄 许可证

MIT License

---

**祝编织愉快！🧶✨**
