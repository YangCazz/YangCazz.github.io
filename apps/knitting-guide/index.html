<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelKnit - 像素织梦 - YangCazz</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- 粒子背景画布 -->
    <canvas id="particleCanvas"></canvas>
    
    <script>
    // 粒子系统 - 与博客主页保持一致
    class ParticleSystem {
        constructor() {
            this.canvas = document.getElementById('particleCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.particles = [];
            this.mouse = { x: 0, y: 0 };
            this.init();
        }
        
        init() {
            this.resizeCanvas();
            this.createParticles();
            this.animate();
            
            window.addEventListener('resize', () => this.resizeCanvas());
            window.addEventListener('mousemove', (e) => {
                this.mouse.x = e.clientX;
                this.mouse.y = e.clientY;
            });
        }
        
        resizeCanvas() {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;
        }
        
        createParticles() {
            const particleCount = Math.floor((this.canvas.width * this.canvas.height) / 15000);
            this.particles = [];
            
            for (let i = 0; i < particleCount; i++) {
                this.particles.push({
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 2 + 1,
                    opacity: Math.random() * 0.5 + 0.1
                });
            }
        }
        
        animate() {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            
            this.particles.forEach((particle, index) => {
                // 更新位置
                particle.x += particle.vx;
                particle.y += particle.vy;
                
                // 边界检查
                if (particle.x < 0 || particle.x > this.canvas.width) particle.vx *= -1;
                if (particle.y < 0 || particle.y > this.canvas.height) particle.vy *= -1;
                
                // 鼠标交互
                const dx = this.mouse.x - particle.x;
                const dy = this.mouse.y - particle.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 100) {
                    const force = (100 - distance) / 100;
                    particle.vx += dx * force * 0.001;
                    particle.vy += dy * force * 0.001;
                }
                
                // 绘制粒子
                this.ctx.beginPath();
                this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                this.ctx.fillStyle = `rgba(66, 153, 225, ${particle.opacity})`;
                this.ctx.fill();
                
                // 连接线
                for (let j = index + 1; j < this.particles.length; j++) {
                    const other = this.particles[j];
                    const dx = particle.x - other.x;
                    const dy = particle.y - other.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 100) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(particle.x, particle.y);
                        this.ctx.lineTo(other.x, other.y);
                        this.ctx.strokeStyle = `rgba(66, 153, 225, ${0.1 * (1 - distance / 100)})`;
                        this.ctx.lineWidth = 1;
                        this.ctx.stroke();
                    }
                }
            });
            
            requestAnimationFrame(() => this.animate());
        }
    }
    
    // 页面加载完成后初始化粒子系统
    document.addEventListener('DOMContentLoaded', function() {
        new ParticleSystem();
    });
    </script>
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="/">
                    <span class="brand-text">YangCazz</span>
                    <span class="brand-dot">.</span>
                </a>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">
                    <span class="nav-icon">⌂</span>
                    <span class="nav-text">首页</span>
                </a>
                <a href="/blog" class="nav-link">
                    <span class="nav-icon">◆</span>
                    <span class="nav-text">博客</span>
                </a>
                <a href="/resume" class="nav-link">
                    <span class="nav-icon">◈</span>
                    <span class="nav-text">简历</span>
                </a>
                <a href="/about" class="nav-link">
                    <span class="nav-icon">◉</span>
                    <span class="nav-text">关于</span>
                </a>
                <a href="/apps" class="nav-link">
                    <span class="nav-icon">◐</span>
                    <span class="nav-text">应用</span>
                </a>
            </div>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="content-wrapper">
            <div class="app-container">
                <!-- 页面头部 -->
                <header class="app-header">
                    <div class="app-header-content">
                        <img src="/assets/images/knitting-guide/logo/PixelKnit_logo.png" alt="PixelKnit Logo" class="app-logo">
                        <div class="app-header-text">
                            <h1 class="app-title">PixelKnit 像素织梦</h1>
                            <p class="app-subtitle">网格编织的自定义和可视化工具</p>
                        </div>
                    </div>
                </header>

        <!-- 主内容区域 -->
        <div class="main-container">
            <!-- 左侧：地图列表 -->
            <aside class="maps-sidebar">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">地图列表</h2>
                </div>
                <div id="maps-list-container" class="maps-list-container">
                    <!-- 地图列表将动态生成 -->
                </div>
            </aside>

            <!-- 中间：主网格编织图 / 编辑界面 -->
            <main class="main-grid-section">
                <!-- 主网格区域（浏览和编辑共用） -->
                <div id="browse-mode-container" class="mode-container">
                    <div class="section-header">
                        <h2 class="section-title" id="section-title-text">网格编织图</h2>
                        <div class="section-actions" id="section-actions" style="display: none;">
                            <button id="exit-edit-mode-btn" class="btn btn-exit-edit">退出编辑</button>
                        </div>
                    </div>
                    
                    <!-- 编辑工具栏（仅在编辑模式显示） -->
                    <div class="edit-toolbar" id="edit-toolbar" style="display: none;">
                        <div class="toolbar-group">
                            <label class="toolbar-label">宽度:</label>
                            <input type="number" id="edit-width-input" class="toolbar-input" value="100" min="10" max="500">
                            <label class="toolbar-label">高度:</label>
                            <input type="number" id="edit-height-input" class="toolbar-input" value="100" min="10" max="500">
                            <button id="apply-size-btn" class="btn btn-toolbar">应用尺寸</button>
                        </div>
                        <div class="toolbar-group">
                            <button id="save-map-btn" class="btn btn-toolbar btn-primary" title="保存地图">保存地图</button>
                            <button id="clear-map-btn" class="btn btn-toolbar" title="清空地图">清空</button>
                            <button id="undo-btn" class="btn btn-toolbar" title="撤销 (Ctrl+Z)" disabled>撤销</button>
                            <button id="redo-btn" class="btn btn-toolbar" title="重做 (Ctrl+Y)" disabled>重做</button>
                        </div>
                        <div class="toolbar-group">
                            <button id="import-image-btn" class="btn btn-toolbar" title="导入图片">导入图片</button>
                            <input type="file" id="image-input" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <!-- 主画布（浏览和编辑共用） -->
                    <div class="canvas-wrapper">
                        <canvas id="main-grid-canvas"></canvas>
                    </div>
                    
                    <!-- 浏览模式按钮（仅在浏览模式显示） -->
                    <div id="browse-mode-actions" style="display: flex; justify-content: center; margin-top: 1.5rem;">
                        <button id="mark-completed-btn" class="btn btn-primary">标记为已完成</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- 右侧：浮动控制面板 -->
        <aside class="floating-controls">
            <!-- 浏览模式：对角编织模式 -->
            <div id="browse-controls" class="mode-controls">
                <h3 class="controls-title">对角编织模式</h3>
            <div id="current-path-status" class="path-status" style="display: none;">
                <p class="path-info">总方块数: <span id="path-total-squares">0</span></p>
                <div id="path-color-breakdown" class="color-breakdown-container"></div>
            </div>
            <button id="enter-diagonal-mode-btn" class="btn btn-mode">进入对角预设模式</button>
            <button id="prev-diagonal-btn" class="btn btn-nav" disabled>上一条</button>
            <button id="next-diagonal-btn" class="btn btn-nav" disabled>下一条</button>
            <div class="divider"></div>
            <button id="save-progress-btn" class="btn btn-save">保存当前进度</button>
            <button id="load-progress-btn" class="btn btn-load" disabled>加载上次进度</button>
            <button id="reset-progress-btn" class="btn btn-reset">重置当前进度</button>
            <div class="progress-section">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar-fill"></div>
                    <span class="progress-text" id="progress-text">0%</span>
                </div>
            </div>
            </div>
            
            <!-- 编辑模式：调色板 -->
            <div id="edit-controls" class="mode-controls hidden">
                <h3 class="controls-title">调色板</h3>
                <div class="current-color-display">
                    <div id="current-color-preview" class="color-preview-large"></div>
                    <div class="color-info">
                        <span id="current-color-text" class="color-text">当前颜色</span>
                        <span id="current-color-rgb" class="color-rgb">RGB(255, 255, 255)</span>
                    </div>
                </div>
                <div id="color-palette" class="color-palette-grid">
                    <!-- 颜色将通过 JavaScript 动态生成 -->
                </div>
                <div class="color-picker-actions">
                    <input type="color" id="custom-color-input" class="custom-color-input" value="#ffffff">
                    <button id="add-color-btn" class="btn btn-small">添加到调色板</button>
                </div>
            </div>
        </aside>

        <!-- 底部：编织顺序横条 -->
        <div id="path-color-sequence-container" class="color-sequence-container hidden">
            <p class="sequence-label">当前编织顺序:</p>
            <div id="path-color-sequence" class="color-sequence"></div>
        </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
</body>
</html>
