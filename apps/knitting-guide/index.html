<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>针织引导 - Knitting Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <h1>🧶 针织引导</h1>
            <p class="subtitle">✨ 将图片转换为针织图案，逐步引导完成编织</p>
        </header>

        <!-- 控制面板 -->
        <div class="control-panel">
            <div class="upload-section">
                <div class="mode-selector">
                    <label>
                        <input type="radio" name="mode" value="convert" checked>
                        <span>📷 普通图片转换</span>
                    </label>
                    <label>
                        <input type="radio" name="mode" value="pattern">
                        <span>🧶 已有针织图案</span>
                    </label>
                </div>
                
                <label for="imageUpload" class="upload-btn">
                    <span>📁</span>
                    <span>选择图片</span>
                    <input type="file" id="imageUpload" accept="image/*" hidden>
                </label>
                
                <button id="loadExampleBtn" class="btn btn-secondary">
                    <span>🎨</span>
                    <span>加载示例</span>
                </button>
                
                <div class="settings" id="convertSettings">
                    <div class="setting-item">
                        <label>网格大小：</label>
                        <input type="number" id="gridSize" min="10" max="100" value="30">
                        <span class="unit">像素</span>
                    </div>
                    
                    <div class="setting-item">
                        <label>颜色数量：</label>
                        <input type="number" id="colorCount" min="2" max="20" value="8">
                        <span class="unit">种</span>
                    </div>
                    
                    <button id="generateBtn" class="btn btn-primary">
                        <span>🎨</span>
                        <span>生成图案</span>
                    </button>
                </div>
                
                <div class="settings" id="patternSettings" style="display: none;">
                    <div class="setting-item">
                        <label>自动检测网格</label>
                        <input type="checkbox" id="autoDetectGrid" checked>
                    </div>
                    
                    <div class="setting-item">
                        <label>网格线颜色：</label>
                        <input type="color" id="gridLineColor" value="#cccccc">
                    </div>
                    
                    <button id="analyzeBtn" class="btn btn-primary">
                        <span>🔍</span>
                        <span>分析图案</span>
                    </button>
                </div>
            </div>
            
            <!-- 调试信息面板 -->
            <div class="debug-panel" id="debugPanel" style="display: none;">
                <h4>🔧 检测信息</h4>
                <div class="debug-content" id="debugContent">
                    <p>打开浏览器控制台（F12）查看详细的分析日志</p>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <button id="startBtn" class="btn btn-success">
                    <span>▶</span>
                    <span>开始引导</span>
                </button>
                <button id="pauseBtn" class="btn btn-warning" style="display: none;">
                    <span>⏸</span>
                    <span>暂停</span>
                </button>
                <button id="prevBtn" class="btn btn-secondary">
                    <span>⬅</span>
                    <span>上一步</span>
                </button>
                <button id="nextBtn" class="btn btn-primary">
                    <span>➡</span>
                    <span>下一步</span>
                </button>
                <button id="resetBtn" class="btn btn-danger">
                    <span>🔄</span>
                    <span>重置</span>
                </button>
                <button id="saveBtn" class="btn btn-info">
                    <span>💾</span>
                    <span>保存进度</span>
                </button>
                <button id="exportBtn" class="btn btn-secondary">
                    <span>📤</span>
                    <span>导出图案</span>
                </button>
            </div>

            <!-- 进度信息 -->
            <div class="progress-info" id="progressInfo" style="display: none;">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-text">
                    <span>进度：<strong id="currentStitch">0</strong> / <strong id="totalStitches">0</strong></span>
                    <span>完成度：<strong id="percentage">0%</strong></span>
                </div>
                <div class="current-color-info">
                    <span>当前颜色：</span>
                    <div class="color-preview" id="currentColorPreview"></div>
                    <span id="currentColorCode">#000000</span>
                </div>
            </div>
        </div>

        <!-- 主工作区 -->
        <div class="workspace">
            <!-- 原图预览 -->
            <div class="preview-section">
                <h3>原始图片</h3>
                <canvas id="originalCanvas"></canvas>
            </div>

            <!-- 针织图案 -->
            <div class="pattern-section">
                <h3>针织图案</h3>
                <div class="canvas-container">
                    <canvas id="patternCanvas"></canvas>
                    <div id="tooltip" class="tooltip" style="display: none;"></div>
                </div>
                <div class="zoom-controls">
                    <button id="zoomIn" class="btn-icon">🔍+</button>
                    <button id="zoomOut" class="btn-icon">🔍-</button>
                    <button id="fitScreen" class="btn-icon">📐</button>
                </div>
            </div>
        </div>

        <!-- 调色板 -->
        <div class="palette-section" id="paletteSection" style="display: none;">
            <h3>🎨 调色板</h3>
            <div id="colorPalette" class="color-palette"></div>
        </div>

        <!-- 说明 -->
        <div class="instructions">
            <h3>📖 使用说明</h3>
            
            <h4>🎨 快速开始：加载示例</h4>
            <ol>
                <li><strong>加载示例</strong>：点击"🎨 加载示例"按钮，立即加载预设的针织图案</li>
                <li><strong>开始引导</strong>：点击"▶ 开始引导"按钮，开始逐步编织</li>
                <li><strong>跟随指引</strong>：红色高亮框会指示当前要编织的方块和颜色</li>
                <li><strong>保存进度</strong>：随时保存进度，下次可继续编织</li>
            </ol>
            
            <h4>📷 模式一：普通图片转换</h4>
            <ol>
                <li><strong>选择模式</strong>：选择"📷 普通图片转换"</li>
                <li><strong>选择图片</strong>：点击"📁 选择图片"上传您想要转换的图像</li>
                <li><strong>设置参数</strong>：调整网格大小（影响图案精细度）和颜色数量</li>
                <li><strong>生成图案</strong>：点击"🎨 生成图案"将图片转换为针织图案</li>
                <li><strong>导出图案</strong>：（可选）点击"📤 导出图案"保存为JSON文件</li>
                <li><strong>开始编织</strong>：点击"▶ 开始引导"进入引导模式</li>
            </ol>
            
            <h4>🧶 模式二：已有针织图案分析（实验性功能）</h4>
            <ol>
                <li><strong>选择模式</strong>：选择"🧶 已有针织图案"</li>
                <li><strong>上传图案</strong>：上传已有的针织图案图片（必须有清晰的网格线）</li>
                <li><strong>自动检测</strong>：勾选"自动检测网格"让应用自动识别</li>
                <li><strong>分析图案</strong>：点击"🔍 分析图案"按钮</li>
                <li><strong>查看调试</strong>：查看"🔧 检测信息"面板了解分析过程</li>
                <li><strong>导出使用</strong>：如果分析成功，点击"📤 导出图案"保存为示例文件</li>
            </ol>
            
            <h4>📤 创建自己的示例图案</h4>
            <ol>
                <li><strong>生成图案</strong>：通过普通图片转换或图案分析获得图案</li>
                <li><strong>导出文件</strong>：点击"📤 导出图案"按钮下载JSON文件</li>
                <li><strong>重命名文件</strong>：将下载的文件重命名为 <code>example-pattern.json</code></li>
                <li><strong>替换文件</strong>：将文件放到应用目录（与index.html同级）</li>
                <li><strong>加载使用</strong>：刷新页面后点击"🎨 加载示例"即可使用</li>
            </ol>
            <div class="tips">
                <h4>💡 小提示</h4>
                <ul>
                    <li>网格大小越小，图案越精细，但编织难度越大</li>
                    <li>建议初学者选择20-30像素的网格大小</li>
                    <li>颜色数量越少，编织越简单，建议从6-8种颜色开始</li>
                    <li>使用键盘方向键可快速导航</li>
                    <li>使用空格键标记完成当前方块</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

